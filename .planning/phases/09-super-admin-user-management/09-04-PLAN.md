---
phase: 09-super-admin-user-management
plan: 04
type: execute
wave: 3
depends_on: ["09-02", "09-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Super Admin can generate invitation codes and see them in list"
    - "Super Admin can approve pending users with role assignment"
    - "Super Admin can reject pending users"
    - "Super Admin can view all users with full information"
    - "Super Admin can deactivate users with email confirmation"
    - "Super Admin cannot deactivate last Super Admin"
    - "Super Admin can reactivate deactivated users"
    - "Super Admin can delete deactivated users"
    - "Super Admin can change user roles"
  artifacts: []
  key_links: []
---

<objective>
End-to-end verification of complete User Management functionality.

Purpose: Confirm all user management operations work correctly with real user interactions before marking phase complete.
Output: Verified working User Management system with all safety measures confirmed.
</objective>

<execution_context>
@C:\Users\Admin\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Admin\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-super-admin-user-management/09-CONTEXT.md
@.planning/phases/09-super-admin-user-management/09-01-SUMMARY.md
@.planning/phases/09-super-admin-user-management/09-02-SUMMARY.md
@.planning/phases/09-super-admin-user-management/09-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete User Management system with invitation codes, pending approvals, and user actions</what-built>
  <how-to-verify>
**Test Environment Setup:**
1. Start local server: python -m http.server 8000
2. Navigate to http://localhost:8000
3. Log in as Super Admin

**Test Block 1: Invitation Code Management**
1. Navigate to User Management -> Invitation Codes tab
2. Click "Generate New Code"
3. Verify:
   - [ ] Code appears in list immediately
   - [ ] Code is in UUID format (xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)
   - [ ] Toast shows code was copied
   - [ ] Status shows "Unused"
   - [ ] Expiration time displayed
4. Click copy button on existing code
5. Paste somewhere to verify clipboard content

**Test Block 2: User Registration (Create Test User)**
1. Open new incognito/private browser window
2. Navigate to http://localhost:8000/#/register
3. Register with the invitation code you generated:
   - Email: testuser@example.com
   - Full name: Test User
   - Password: TestPass123!
   - Invitation code: (paste generated code)
4. Complete registration
5. Verify user lands on pending page

**Test Block 3: Pending User Approval**
1. Return to Super Admin window
2. Navigate to Pending Approvals tab
3. Verify testuser@example.com appears in list
4. Click "Approve"
5. Verify:
   - [ ] Modal opens with role dropdown
   - [ ] User info displayed (email, name)
   - [ ] Role defaults to Operations User
6. Change role to "Finance" and confirm
7. Verify user disappears from pending list
8. Check Firestore: user should have status='active', role='finance'

**Test Block 4: Invitation Code Used Status**
1. Return to Invitation Codes tab
2. Verify:
   - [ ] Code used by testuser shows "Used" status
   - [ ] Shows "Used by testuser@example.com"
   - [ ] Used date displayed

**Test Block 5: User List Display**
1. Navigate to All Users tab
2. Verify:
   - [ ] testuser@example.com appears in list
   - [ ] Role shows "Finance"
   - [ ] Status shows "Active"
   - [ ] Assigned Projects shows "-" (not applicable for Finance)
3. Use search to filter by "test"
4. Verify only testuser appears

**Test Block 6: Role Change**
1. Click action menu (three dots) for testuser
2. Click "Edit Role"
3. Verify:
   - [ ] Modal shows current role
   - [ ] Dropdown has all 5 roles
4. Change to "Operations User"
5. Confirm change
6. Verify role updates in list

**Test Block 7: Deactivation with Email Confirmation**
1. Click action menu for testuser
2. Click "Deactivate"
3. Verify:
   - [ ] Modal shows warning about consequences
   - [ ] Email input required
   - [ ] Deactivate button disabled until email typed
4. Type wrong email - verify button stays disabled
5. Type correct email "testuser@example.com"
6. Click Deactivate
7. Verify:
   - [ ] User status changes to "Deactivated"
   - [ ] User disappears from pending test user's session (if still logged in)

**Test Block 8: Reactivation**
1. Click action menu for deactivated testuser
2. Verify "Deactivate" option is not shown
3. Click "Reactivate"
4. Confirm reactivation
5. Verify status changes back to "Active"

**Test Block 9: Delete (Two-Step)**
1. Deactivate testuser again
2. Click action menu
3. Verify "Delete" option appears
4. Click Delete
5. Verify:
   - [ ] Confirmation modal appears
   - [ ] Warning about permanent deletion
6. Confirm deletion
7. Verify user removed from list

**Test Block 10: Last Super Admin Protection**
1. Check All Users for Super Admin accounts
2. If only one Super Admin (yourself):
   - Try to deactivate yourself - verify action not available
   - Try to change your role - verify error message
3. If multiple Super Admins:
   - Create a new user via registration + approval as Super Admin
   - Try to deactivate one - should work
   - Try to deactivate the last one - should be blocked with error

**Test Block 11: Rejection Flow**
1. Generate new invitation code
2. Register another test user in incognito
3. Go to Pending Approvals
4. Click "Reject"
5. Verify:
   - [ ] Confirmation dialog appears
   - [ ] Mentions permanent deletion
6. Confirm rejection
7. Verify user removed from list
8. Check Firestore: user document should be deleted
  </how-to-verify>
  <resume-signal>
Type "approved" if all 11 test blocks pass.
Type issues found if any test fails (e.g., "Block 7 failed - deactivate button enabled without email").
  </resume-signal>
</task>

</tasks>

<verification>
All 11 test blocks completed successfully:
1. Invitation code generation and display
2. User registration with invitation code
3. Pending user approval with role assignment
4. Invitation code status updates
5. User list display with all columns
6. Role change functionality
7. Deactivation with email confirmation
8. Reactivation of deactivated users
9. Deletion of deactivated users
10. Last Super Admin protection
11. Rejection flow for pending users
</verification>

<success_criteria>
- All Phase 9 requirements verified working
- AUTH-10 through AUTH-15 complete
- ADMIN-01 through ADMIN-07 complete (except ADMIN-06 which is Phase 7)
- Safety measures confirmed functional
- User experience flows smoothly
- No console errors during normal operations
</success_criteria>

<output>
After completion, create `.planning/phases/09-super-admin-user-management/09-04-SUMMARY.md`
</output>
