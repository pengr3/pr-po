---
phase: 01-clients-foundation
plan: 02
type: execute
wave: 2
depends_on: [01-01]
files_modified:
  - app/router.js
  - index.html
autonomous: false

must_haves:
  truths:
    - "User can click 'Clients' in navigation to view client management"
    - "Browser URL changes to #/clients when navigating"
    - "Client view loads without errors"
    - "Navigation back to other pages works correctly"
  artifacts:
    - path: "app/router.js"
      provides: "Route configuration for /clients"
      contains: "'/clients':"
    - path: "index.html"
      provides: "Navigation link to clients"
      contains: "href=\"#/clients\""
  key_links:
    - from: "index.html nav link"
      to: "app/router.js"
      via: "hash navigation"
      pattern: "href=\"#/clients\""
    - from: "app/router.js"
      to: "app/views/clients.js"
      via: "dynamic import"
      pattern: "import\\('\\./views/clients\\.js'\\)"
---

<objective>
Integrate clients view into the SPA navigation by adding route configuration and navigation link.

Purpose: Make the client management interface accessible through the application navigation.
Output: Fully working navigation to clients view from anywhere in the app.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-clients-foundation/01-RESEARCH.md
@.planning/phases/01-clients-foundation/01-01-SUMMARY.md

# Files to modify
@app/router.js
@index.html

# Pattern reference
@CLAUDE.md
@.planning/codebase/STRUCTURE.md
</context>

<tasks>

<task type="auto">
  <name>Add /clients route to router configuration</name>
  <files>app/router.js</files>
  <action>
Add the `/clients` route to the routes object in `app/router.js`.

**Location:** Add to the routes object (around line 13-36 based on research).

**Route configuration:**
```javascript
'/clients': {
    name: 'Clients',
    load: () => import('./views/clients.js'),
    title: 'Clients | CLMC Procurement'
}
```

**Placement:** Insert alphabetically or after existing routes (before or after '/finance', '/mrf-form', '/procurement').

**Important:**
- Use arrow function for lazy loading: `() => import('./views/clients.js')`
- Correct relative path: `'./views/clients.js'` (router.js is in app/, clients.js is in app/views/)
- No defaultTab needed (clients view has no tabs)
- Match naming convention of existing routes
  </action>
  <verify>
1. Route exists: `grep -A 3 "'/clients':" app/router.js`
2. Correct import path: `grep "import('./views/clients.js')" app/router.js`
3. No syntax errors: `node -c app/router.js` (or check console after refresh)
  </verify>
  <done>
- `/clients` route added to routes object in router.js
- Route has name, load (dynamic import), and title properties
- Import path is correct: `'./views/clients.js'`
  </done>
</task>

<task type="auto">
  <name>Add Clients navigation link to index.html</name>
  <files>index.html</files>
  <action>
Add the "Clients" navigation link to the top navigation bar in `index.html`.

**Location:** Find the `<nav class="navbar">` or similar navigation element (likely contains existing links like "MRF Form", "Procurement", "Finance").

**Navigation link HTML:**
```html
<a href="#/clients" class="nav-link">Clients</a>
```

**Placement:**
- Add as the first link (before "MRF Form") since clients are foundational to projects
- OR add after "Finance" if grouping all management interfaces together
- Ensure consistent styling with existing nav links (same classes)

**Important:**
- Use hash navigation: `href="#/clients"`
- Match existing nav link class names (likely `nav-link` or similar)
- Ensure spacing/structure matches other nav items
  </action>
  <verify>
1. Nav link exists: `grep "href=\"#/clients\"" index.html`
2. Has correct class: `grep "class=\"nav-link\"" index.html | grep clients`
3. Visual check: Open browser, see "Clients" in navigation bar
  </verify>
  <done>
- Navigation link added to index.html
- Link uses `href="#/clients"` for hash-based routing
- Link has appropriate CSS classes matching other nav items
- Link is visible in the navigation bar
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete client management system integrated into SPA navigation:
- Client CRUD view module (Plan 01-01)
- Router configuration (this plan)
- Navigation link (this plan)
  </what-built>
  <how-to-verify>
**Start dev server:**
```bash
python -m http.server 8000
# OR
npx http-server
```

**Open browser:** http://localhost:8000

**Test navigation:**
1. Click "Clients" in navigation bar
2. Verify URL changes to `http://localhost:8000/#/clients`
3. Verify page title changes to "Clients | CLMC Procurement"

**Test CRUD operations:**

1. **CREATE:**
   - Click "Add Client" button
   - Form appears below
   - Fill in fields:
     - Client Code: `TEST` (verify auto-uppercase)
     - Company Name: `Test Corporation`
     - Contact Person: `John Doe`
     - Contact Details: `john@test.com | 0917-123-4567`
   - Click "Add Client"
   - Verify success toast appears
   - Verify client appears in table
   - Verify form closes

2. **UNIQUENESS VALIDATION:**
   - Click "Add Client" again
   - Try to add client with code `TEST` (same as above)
   - Verify error toast: "Client code 'TEST' already exists"
   - Try lowercase `test` - should also be blocked (converted to TEST)

3. **READ:**
   - Verify client appears in table with all fields
   - Verify table columns: Client Code, Company Name, Contact Person, Contact Details, Actions

4. **UPDATE:**
   - Click "Edit" button on TEST client
   - Row becomes editable with input fields
   - Change Company Name to `Test Corp Updated`
   - Click "Save"
   - Verify success toast
   - Verify updated name shows in table

5. **DELETE:**
   - Click "Delete" button on TEST client
   - Verify confirmation dialog: "Are you sure you want to delete client 'Test Corp Updated'?"
   - Click OK
   - Verify success toast
   - Verify client removed from table

6. **PAGINATION** (if 15+ clients):
   - Add 16 clients (or verify with existing data)
   - Verify pagination controls appear
   - Verify "Showing 1-15 of 16 clients"
   - Click "Next" or page "2"
   - Verify showing "Showing 16-16 of 16 clients"

**Test navigation away and back:**
1. Click "Home" or another nav link
2. Click "Clients" again
3. Verify clients view loads correctly
4. Verify data persists (no errors)

**Check browser console:**
- Look for "[Clients] Module loaded"
- Look for "[Clients] Initializing clients view..."
- No JavaScript errors (red text)
- No Firebase errors

**Expected behavior:**
- All CRUD operations work smoothly
- Uniqueness validation prevents duplicates (case-insensitive)
- Pagination works correctly
- Navigation to/from clients view is seamless
- No console errors

**Common issues to check:**
- Client code NOT auto-uppercase: Check input has `text-transform: uppercase`
- Duplicate codes allowed: Check uniqueness validation logic
- Edit mode persists after delete: Check editingClient reset
- Pagination missing: Add 16+ clients to trigger it
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass, or describe any issues found.

If issues found, Claude will investigate and fix before proceeding.
  </resume-signal>
</task>

</tasks>

<verification>
**Pre-checkpoint verification (automated):**
1. Route exists in router.js
2. Nav link exists in index.html
3. No syntax errors in modified files

**Checkpoint verification (human):**
- Navigation works
- CRUD operations functional
- Uniqueness validation working
- No console errors
</verification>

<success_criteria>
**Measurable completion:**
- [ ] `/clients` route added to router.js with correct config
- [ ] Navigation link added to index.html
- [ ] Clicking "Clients" loads the view without errors
- [ ] URL changes to #/clients
- [ ] Page title changes to "Clients | CLMC Procurement"
- [ ] All CRUD operations verified working
- [ ] Uniqueness validation verified working
- [ ] Navigation to/from other views works
- [ ] No JavaScript errors in console
- [ ] User confirms all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/01-clients-foundation/01-02-SUMMARY.md`
</output>
