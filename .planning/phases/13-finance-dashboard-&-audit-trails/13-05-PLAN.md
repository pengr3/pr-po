---
phase: 13-finance-dashboard-&-audit-trails
plan: 05
type: execute
wave: 1
depends_on: []
files_modified: [app/views/procurement.js]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Supplier rows in Supplier Management tab are clickable"
    - "Clicking supplier row opens purchase history modal showing total spend and PO details"
    - "Modal displays year-to-date spend, PO count, and detailed purchase history table"
  artifacts:
    - path: "app/views/procurement.js"
      provides: "Clickable supplier rows in Supplier Management tab with purchase history modal"
      min_lines: 2000
  key_links:
    - from: "app/views/procurement.js renderSuppliersTable()"
      to: "showSupplierPurchaseHistory()"
      via: "onclick handler on supplier name column"
      pattern: "onclick.*showSupplierPurchaseHistory"
---

<objective>
Move supplier purchase history feature from PR-PO Records tab to Supplier Management tab by adding clickable supplier name rows.

Purpose: Place supplier purchase history access in the logical location (Supplier Management tab where suppliers are listed) instead of PR-PO Records tab where suppliers are not displayed. This matches user expectations and workflow.
Output: Supplier Management tab with clickable supplier names that open purchase history modal showing total spend and detailed PO list.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-finance-dashboard-&-audit-trails/13-02-SUMMARY.md
@.planning/phases/13-finance-dashboard-&-audit-trails/13-UAT.md
@app/views/procurement.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make supplier names clickable in Supplier Management tab</name>
  <files>app/views/procurement.js</files>
  <action>
**Locate renderSuppliersTable() function** (approximately lines 1902-1956 based on UAT diagnostic).

**Current state:** Supplier table renders rows with static supplier names and Edit/Delete buttons only.

**Required changes:**

1. **Add pointer cursor and hover styling to supplier name column:**
   - In the table header, the Supplier Name column is already defined
   - In the data row rendering, supplier name is displayed in a `<td>` element
   - Add CSS classes or inline styles to make supplier name visually interactive:
     - `cursor: pointer` on the supplier name cell
     - `color: #1a73e8` (primary blue from UI design system)
     - Underline on hover: `text-decoration: underline`

2. **Add onclick handler to supplier name cell:**
   ```javascript
   <td class="clickable-supplier" onclick="showSupplierPurchaseHistory('${supplierName}')">
     ${supplierName}
   </td>
   ```

3. **Ensure window function is attached:**
   - showSupplierPurchaseHistory() already exists (lines 402-485 per UAT diagnostic)
   - Verify window.showSupplierPurchaseHistory is set in attachWindowFunctions()
   - If not present, add: `window.showSupplierPurchaseHistory = showSupplierPurchaseHistory;`

4. **Add CSS for clickable supplier styling:**
   In the `<style>` section within render() or in styles/views.css if it exists:
   ```css
   .clickable-supplier {
     cursor: pointer;
     color: #1a73e8;
     font-weight: 500;
   }
   .clickable-supplier:hover {
     text-decoration: underline;
   }
   ```

**Important implementation notes:**
- **DO NOT remove** existing supplier history functionality from PR-PO Records tab (user said "optionally keep as secondary access")
- **DO add** supplier history to Supplier Management tab as primary access point
- The showSupplierPurchaseHistory() function already exists and works correctly
- Modal HTML already exists in render() function
- Only need to wire up the onclick handlers in Supplier Management tab table

**Reference existing implementation:**
- Look at how PR-PO Records tab makes supplier names clickable (lines 2371, 2487 per UAT diagnostic)
- Use same onclick pattern: `onclick="showSupplierPurchaseHistory('${supplierName}')"`
- Follow same styling approach for consistency

**Testing during implementation:**
- After changes, verify table renders correctly
- Verify supplier name shows pointer cursor
- Verify onclick triggers showSupplierPurchaseHistory() function
  </action>
  <verify>
1. Run `grep -n "renderSuppliersTable" app/views/procurement.js` to confirm function location
2. Run `grep -n "clickable-supplier" app/views/procurement.js` to confirm CSS class added
3. Run `grep -n "onclick.*showSupplierPurchaseHistory" app/views/procurement.js | grep -c "renderSuppliersTable"` (should return 1+ matches showing onclick in supplier table)
4. Serve app locally: `python -m http.server 8000`
5. Navigate to Procurement → Supplier Management tab
6. Confirm supplier names display in blue with pointer cursor
7. Click a supplier name and confirm modal opens showing purchase history
  </verify>
  <done>
Supplier Management tab displays clickable supplier names that open purchase history modal showing aggregated totals and detailed PO table
  </done>
</task>

</tasks>

<verification>
**Overall phase checks:**

1. **Code changes validation:**
   - renderSuppliersTable() function modified to add onclick handlers
   - Supplier name column has clickable styling (color, cursor, hover effect)
   - window.showSupplierPurchaseHistory is attached in attachWindowFunctions()
   - CSS classes added for clickable supplier styling

2. **Functionality validation:**
   - Navigate to Procurement → Supplier Management tab
   - Supplier names display in blue with pointer cursor
   - Clicking supplier name opens purchase history modal
   - Modal displays total purchases, PO count, and detailed PO table
   - Modal closes properly with ESC key or Close button

3. **Backward compatibility:**
   - Supplier links in PR-PO Records tab still work (secondary access)
   - showSupplierPurchaseHistory() function unchanged
   - Modal HTML unchanged

4. **User workflow improved:**
   - Primary supplier history access is now in Supplier Management tab (logical location)
   - Secondary access remains in PR-PO Records tab (convenience)
   - Feature location matches user expectations
</verification>

<success_criteria>
1. Supplier Management tab displays supplier names as clickable links with blue color and pointer cursor
2. Clicking supplier name in Supplier Management tab opens purchase history modal
3. Modal displays aggregated total purchases, PO count, and detailed purchase history table
4. Modal closes properly with ESC key or Close button
5. Supplier links in PR-PO Records tab continue to work (secondary access)
6. UAT tests 6, 7, 8 now pass (feature in correct location)
</success_criteria>

<output>
After completion, create `.planning/phases/13-finance-dashboard-&-audit-trails/13-05-SUMMARY.md`
</output>
