---
phase: 17-procurement-workflow-overhaul
plan: 04
type: execute
wave: 2
depends_on: ["17-02"]
files_modified:
  - app/views/procurement.js
autonomous: true

must_haves:
  truths:
    - "Clicking supplier name in Supplier Management always opens purchase history modal"
    - "Clickable supplier names removed from PRs and POs columns in MRF Records"
    - "Only one way to access supplier purchase history (Supplier Management tab)"
  artifacts:
    - path: "app/views/procurement.js"
      provides: "Consistent supplier modal behavior, cleaned PR/PO columns"
      min_lines: 4360
  key_links:
    - from: "Supplier Management table"
      to: "showSupplierPurchaseHistory()"
      via: "Clickable supplier name"
      pattern: "onclick=\"window\\.showSupplierPurchaseHistory"
    - from: "MRF Records PR/PO columns"
      to: "NO supplier links"
      via: "Text-only supplier display (if needed)"
---

<objective>
Remove inline supplier links from PR and PO columns in MRF Records table to ensure consistent supplier modal access only through Supplier Management tab.

Purpose: Simplify navigation and ensure supplier purchase history modal is accessed from the canonical location (Supplier Management tab) where it makes the most sense. Reduces visual clutter in MRF Records table.

Output: Cleaned PR/PO column rendering without inline supplier links. Supplier purchase history remains accessible via Supplier Management tab.
</objective>

<execution_context>
@C:\Users\franc\dev\projects\pr-po\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\franc\dev\projects\pr-po\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\franc\dev\projects\pr-po\.planning\PROJECT.md
@C:\Users\franc\dev\projects\pr-po\.planning\ROADMAP.md
@C:\Users\franc\dev\projects\pr-po\.planning\STATE.md
@C:\Users\franc\dev\projects\pr-po\.planning\phases\17-procurement-workflow-overhaul\17-RESEARCH.md
@C:\Users\franc\dev\projects\pr-po\.planning\phases\17-procurement-workflow-overhaul\17-02-SUMMARY.md
@C:\Users\franc\dev\projects\pr-po\CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove inline supplier links from PRs column</name>
  <files>app/views/procurement.js</files>
  <action>
Update the PR column rendering in `renderPRPORecords()` to remove clickable supplier names:

1. Locate the PR column cell rendering (in the rows construction within `renderPRPORecords()`).

2. Current pattern likely includes:
```javascript
// BEFORE - with supplier link
<a href="javascript:void(0)"
   onclick="window.viewPRDetails('${pr.docId}')">${pr.pr_id}</a>
${pr.supplier_name ? `
    <a href="javascript:void(0)"
       onclick="window.showSupplierPurchaseHistory('${pr.supplier_name}')"
       style="color: #1a73e8;">
        ${pr.supplier_name}
    </a>
` : ''}
```

3. Replace with:
```javascript
// AFTER - no supplier link
<a href="javascript:void(0)"
   onclick="window.viewPRDetails('${pr.docId}')"
   style="color: #1a73e8; text-decoration: none;">
    ${pr.pr_id}
</a>
```

4. **Remove entirely:** The inline supplier name display after PR ID. PRs column should only show PR IDs, not supplier names.

**Rationale:** Per success criteria #4, "Clickable supplier names removed from PRs/POs columns". Supplier info is visible in PR Details modal (View button).
  </action>
  <verify>
```bash
# Verify no supplier links in PR rendering
grep -A 5 "viewPRDetails" app/views/procurement.js | grep -c "showSupplierPurchaseHistory"  # Should be 0

# Verify PR column only shows PR ID
grep -A 5 "viewPRDetails" app/views/procurement.js | grep "pr.pr_id"
```
  </verify>
  <done>
- PRs column displays only PR IDs (linked to viewPRDetails modal)
- Inline supplier names removed from PRs column
- No showSupplierPurchaseHistory() calls in PR rendering
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove inline supplier links from POs column</name>
  <files>app/views/procurement.js</files>
  <action>
Update the PO column rendering in `renderPRPORecords()` to remove clickable supplier names:

1. Locate the PO column cell rendering (likely adjacent to PR column rendering).

2. Current pattern likely includes:
```javascript
// BEFORE - with supplier link
<a href="javascript:void(0)"
   onclick="window.viewPODetails('${po.docId}')">${po.po_id}</a>
${po.supplier_name ? `
    <a href="javascript:void(0)"
       onclick="window.showSupplierPurchaseHistory('${po.supplier_name}')"
       style="color: #1a73e8;">
        ${po.supplier_name}
    </a>
` : ''}
```

3. Replace with:
```javascript
// AFTER - no supplier link
<a href="javascript:void(0)"
   onclick="window.viewPODetails('${po.docId}')"
   style="color: #1a73e8; text-decoration: none;">
    ${po.po_id}
</a>
```

4. **Remove entirely:** The inline supplier name display after PO ID. POs column should only show PO IDs, not supplier names.

**Consistency:** Both PR and PO columns follow same pattern - ID only, clickable to details modal.
  </action>
  <verify>
```bash
# Verify no supplier links in PO rendering
grep -A 5 "viewPODetails" app/views/procurement.js | grep -c "showSupplierPurchaseHistory"  # Should be 0

# Verify PO column only shows PO ID
grep -A 5 "viewPODetails" app/views/procurement.js | grep "po.po_id"
```
  </verify>
  <done>
- POs column displays only PO IDs (linked to viewPODetails modal)
- Inline supplier names removed from POs column
- No showSupplierPurchaseHistory() calls in PO rendering
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. **MRF Records Table:**
   - Navigate to Procurement → MRF Records
   - PRs column should show only PR IDs (clickable to details)
   - POs column should show only PO IDs (clickable to details)
   - No supplier names visible in PRs or POs columns

2. **Supplier Management Table:**
   - Navigate to Procurement → Supplier Management
   - Supplier names should be clickable
   - Clicking supplier name opens purchase history modal
   - Modal shows all POs for that supplier

3. **Supplier Management Modal Consistency:**
   - Verify that Supplier Management table uses this pattern:
   ```javascript
   <td class="clickable-supplier"
       onclick="window.showSupplierPurchaseHistory('${supplier.supplier_name}')"
       style="cursor: pointer; color: #1a73e8;">
       ${supplier.supplier_name}
   </td>
   ```
   - Verify showSupplierPurchaseHistory() function is correctly wired
   - This should be the only way to access supplier purchase history

4. **Modal Access:**
   - Confirm supplier purchase history is only accessible from Supplier Management tab
   - No other way to trigger the modal exists
   - Modal still functions correctly (displays supplier POs)

5. **Details Modals:**
   - Click "View" on a PR → PR Details modal opens
   - Click "View" on a PO → PO Details modal opens
   - Supplier info visible in these modals (but not as links)
</verification>

<success_criteria>
- [x] Supplier Management: Clicking supplier name opens purchase history modal
- [x] MRF Records: Clickable supplier names removed from PRs column
- [x] MRF Records: Clickable supplier names removed from POs column
- [x] Only one access point for supplier purchase history (Supplier Management)
- [x] PR/PO Details modals still functional (View buttons work)
- [x] Visual clutter reduced in MRF Records table
</success_criteria>

<output>
After completion, create `.planning/phases/17-procurement-workflow-overhaul/17-04-SUMMARY.md`
</output>
