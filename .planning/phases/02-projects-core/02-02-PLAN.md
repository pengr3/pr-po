---
phase: 02-projects-core
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - app/router.js
  - index.html
autonomous: false

must_haves:
  truths:
    - "User can click Projects in navigation to access project management"
    - "Projects route loads projects.js view module"
    - "Page title updates to 'Projects | CLMC Procurement' when navigating to projects"
    - "Projects view displays correctly with all CRUD functionality working"
    - "User can navigate between Clients and Projects tabs without errors"
  artifacts:
    - path: "app/router.js"
      provides: "Route configuration for /projects"
      contains: "'/projects':"
    - path: "index.html"
      provides: "Navigation link to projects view"
      contains: "#/projects"
  key_links:
    - from: "index.html navigation"
      to: "app/router.js /projects route"
      via: "hash navigation click"
      pattern: 'href="#/projects"'
    - from: "app/router.js"
      to: "app/views/projects.js"
      via: "lazy module loading"
      pattern: "import.*views/projects"
---

<objective>
Integrate projects view into SPA navigation by adding route configuration and navigation link, following the proven pattern from Phase 01-02 (clients router integration).

Purpose: Make project management accessible to users through the top navigation bar. Completes Phase 2 by connecting the project CRUD interface to the application routing system.

Output: Working navigation to projects view with lazy module loading and proper page title updates.
</objective>

<execution_context>
@C:\Users\franc\dev\projects\pr-po\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\franc\dev\projects\pr-po\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\franc\dev\projects\pr-po\.planning\PROJECT.md
@C:\Users\franc\dev\projects\pr-po\.planning\ROADMAP.md
@C:\Users\franc\dev\projects\pr-po\.planning\STATE.md
@C:\Users\franc\dev\projects\pr-po\.planning\phases\02-projects-core\02-RESEARCH.md
@C:\Users\franc\dev\projects\pr-po\.planning\phases\01-clients-foundation\01-02-SUMMARY.md
@C:\Users\franc\dev\projects\pr-po\CLAUDE.md
@C:\Users\franc\dev\projects\pr-po\app\router.js
@C:\Users\franc\dev\projects\pr-po\index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add /projects route to router configuration</name>
  <files>app/router.js</files>
  <action>
Add /projects route to app/router.js following the exact pattern from Phase 01-02 (clients route).

1. Open app/router.js
2. Locate the routes object
3. Add new route entry after the /clients route:

```javascript
'/projects': {
    name: 'Projects',
    load: () => import('./views/projects.js'),
    title: 'Projects | CLMC Procurement'
}
```

**Implementation notes:**
- Route key is '/projects' (hash-based routing will use #/projects)
- Name is 'Projects' (singular form matching navigation)
- Use arrow function for lazy loading: `() => import('./views/projects.js')`
- No defaultTab parameter needed (projects view has no tabs like procurement does)
- Title follows pattern: "ViewName | CLMC Procurement"

Follow the exact syntax and structure from the /clients route added in Phase 01-02.
  </action>
  <verify>
1. Read app/router.js
2. Confirm /projects route exists in routes object
3. Verify route uses lazy loading via arrow function
4. Verify title is "Projects | CLMC Procurement"
5. Check no defaultTab parameter (not needed for single-view pages)
  </verify>
  <done>
app/router.js contains /projects route configuration with lazy module loading and proper title. Route will load app/views/projects.js when user navigates to #/projects.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Projects navigation link to top nav</name>
  <files>index.html</files>
  <action>
Add Projects navigation link to index.html top navigation bar following the pattern from Phase 01-02 (Clients link).

1. Open index.html
2. Locate the navigation section (nav element with nav-links)
3. Add new link after the Clients link (before Procurement):

```html
<a href="#/projects" class="nav-link">
    <span class="nav-icon">üìã</span>
    <span>Projects</span>
</a>
```

**Placement reasoning:**
- Clients ‚Üí Projects ‚Üí Procurement (logical flow)
- Projects depend on Clients (client selection in dropdown)
- Procurement depends on Projects (MRF will reference projects in Phase 4)
- Foundational entities appear before dependent ones

**Icon choice:**
- Clients: üè¢ (building/company)
- Projects: üìã (clipboard/project management)
- Existing: Procurement üì¶, Finance üí∞, Home üè†

Use same structure as existing nav links: `class="nav-link"`, icon span, text span.
  </action>
  <verify>
1. Read index.html
2. Confirm Projects link exists in navigation
3. Verify href="#/projects" (hash routing)
4. Verify link placed between Clients and Procurement
5. Check icon span and text span structure matches other links
  </verify>
  <done>
index.html contains Projects navigation link positioned after Clients and before Procurement. Clicking link will navigate to #/projects route.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete project management integration into SPA navigation. Router configured for /projects route with lazy loading. Navigation link added to top nav bar.
  </what-built>
  <how-to-verify>
**Test navigation and project CRUD workflow:**

1. **Navigate to projects view:**
   - Open browser to application (http://localhost:8000 or deployed URL)
   - Click "Projects" in top navigation
   - Verify: URL changes to #/projects
   - Verify: Page title in browser tab shows "Projects | CLMC Procurement"
   - Verify: Projects table displays with "Loading projects..." or empty state
   - Check browser console for "[Projects] Initializing projects view..." log

2. **Test tab switching (router lifecycle):**
   - Click "Clients" tab
   - Check console for "[Projects] Destroying projects view..." log
   - Click "Projects" tab again
   - Check console for "[Projects] Initializing projects view..." log
   - Verify: No errors in console during navigation

3. **Test project creation workflow:**
   - Click "Add Project" button
   - Verify: Form appears with all fields (Client dropdown, Project Name, Internal Status, Project Status, Budget, Contract Cost, Personnel)
   - Verify: Client dropdown is populated with clients (if clients exist from Phase 1)
   - Fill in required fields:
     - Select a client from dropdown
     - Enter project name: "Test Office Renovation"
     - Select Internal Status: "For Proposal"
     - Select Project Status: "Pending Client Review"
   - Leave budget and contract cost blank
   - Click "Add Project"
   - Verify: Success toast appears
   - Verify: Project appears in table with auto-generated code format CLMC_CLIENTCODE_2026001
   - Verify: Form closes automatically

4. **Test optional field validation:**
   - Click "Add Project" again
   - Fill required fields
   - Enter Budget: 0
   - Click "Add Project"
   - Verify: Error toast appears: "Budget must be a positive number"
   - Change Budget to: 50000.50
   - Click "Add Project"
   - Verify: Project created successfully with budget value

5. **Test dual status fields:**
   - Verify created project shows correct Internal Status and Project Status in table
   - Click "Edit" on a project row
   - Verify: Both status dropdowns show current values pre-selected
   - Change Internal Status to "For Internal Approval"
   - Change Project Status to "Under Client Review"
   - Click "Save"
   - Verify: Table updates with new status values

6. **Test client dropdown real-time updates:**
   - Keep Projects view open
   - Open new browser tab to #/clients
   - Add a new client (e.g., "TESTCO")
   - Return to Projects tab
   - Click "Add Project" button
   - Verify: New client appears in dropdown without page refresh

7. **Test project code generation:**
   - Create 2 projects for the same client
   - Verify: Project codes increment sequentially (e.g., CLMC_ACME_2026001, CLMC_ACME_2026002)
   - Create 1 project for a different client
   - Verify: Project code starts at 001 for new client (e.g., CLMC_XYZ_2026001)

8. **Test edit and delete:**
   - Click "Edit" on a project
   - Change project name
   - Click "Save"
   - Verify: Project name updates in table
   - Click "Delete" on a project
   - Verify: Confirmation dialog appears with project name
   - Click OK
   - Verify: Project removed from table

9. **Test pagination (if >15 projects):**
   - If you have 15+ projects, verify pagination controls appear
   - Click page 2
   - Verify: Next 15 projects display
   - Verify: Page info shows correct range (e.g., "16-30 of 50 projects")

10. **Check console for errors:**
    - Open browser DevTools Console
    - Verify: No JavaScript errors
    - Verify: No Firebase errors
    - Verify: [Projects] log messages appear for init/destroy
    - Verify: No "undefined is not a function" errors

**Expected results:**
- All navigation works smoothly
- Project creation succeeds with auto-generated codes
- Client dropdown populates and updates in real-time
- Validation works (rejects zero/negative, accepts positive/null)
- Dual status fields save and display correctly
- Edit and delete operations work
- No console errors

**If any issues found:**
Describe the specific issue, what you expected, and what happened instead. Include:
- Which step failed
- Error message (if any)
- Console logs (if relevant)
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Complete project management workflow verified end-to-end:
1. Navigation to projects view works via top nav
2. Router loads projects.js module correctly
3. Project CRUD operations all function (create, read, update, delete)
4. Auto-generated project codes follow CLMC_CLIENT_YYYY### format
5. Client dropdown populated from Firestore with real-time updates
6. Dual status dropdowns function with predefined options
7. Optional number validation enforces positive values or null
8. Active/inactive toggle works
9. Pagination displays for >15 projects
10. No console errors during navigation or CRUD operations
</verification>

<success_criteria>
1. User can access Projects view by clicking navigation link
2. Projects view loads without errors
3. Page title updates correctly
4. All CRUD operations work as expected (tested in checkpoint)
5. Navigation between views (Clients ‚Üî Projects) works smoothly
6. View lifecycle (init/destroy) executes properly during tab switches
7. Real-time updates work across both views (clients ‚Üî projects)
</success_criteria>

<output>
After completion, create `.planning/phases/02-projects-core/02-02-SUMMARY.md` following the template format from Phase 01-02.

Include:
- Performance metrics
- Files modified
- User verification results
- Next phase readiness (ready for Phase 3: Projects Management - filtering, search, detail view)
</output>
