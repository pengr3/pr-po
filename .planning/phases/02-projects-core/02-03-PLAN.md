---
phase: 02-projects-core
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [app/views/projects.js]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can toggle project active/inactive status"
  artifacts:
    - path: "app/views/projects.js"
      provides: "Toggle button in Actions column"
      min_lines: 3
      contains: "toggleProjectActive"
  key_links:
    - from: "app/views/projects.js line 379"
      to: "window.toggleProjectActive"
      via: "onclick button handler"
      pattern: "onclick.*toggleProjectActive"
---

<objective>
Add UI button to allow users to toggle project active/inactive status.

Purpose: Close verification gap PROJ-06 - toggleProjectActive() function exists and is window-attached, but no UI element calls it.
Output: Clickable toggle button in Actions column that calls existing toggleProjectActive function.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@app/views/projects.js
</context>

<tasks>

<task type="auto">
  <name>Add toggle button to Actions column</name>
  <files>app/views/projects.js</files>
  <action>
Modify the renderProjectsTable() function at lines 361-384 to add a Toggle button in the Actions column.

**Location:** Line 379, after the Edit button and before the Delete button

**Code to add:**
```javascript
<button class="btn btn-sm btn-secondary" onclick="toggleProjectActive('${project.id}', ${project.active})">
  ${project.active ? 'Deactivate' : 'Activate'}
</button>
```

**Context:**
- Function toggleProjectActive(projectId, currentStatus) already exists at lines 510-530
- Function already attached to window at line 44
- Function has confirmation dialog and Firestore update logic
- Button should use btn-secondary class to differentiate from Edit (primary) and Delete (danger)
- Button text changes based on current status: "Deactivate" when active, "Activate" when inactive

**Existing line 379 (Edit button):**
```javascript
<button class="btn btn-sm btn-primary" onclick="editProject('${project.id}')">Edit</button>
```

**Existing line 380 (Delete button):**
```javascript
<button class="btn btn-sm btn-danger" onclick="deleteProject('${project.id}', '${project.project_name.replace(/'/g, "\\'")}')">Delete</button>
```

**Updated lines 379-381 should be:**
```javascript
<button class="btn btn-sm btn-primary" onclick="editProject('${project.id}')">Edit</button>
<button class="btn btn-sm btn-secondary" onclick="toggleProjectActive('${project.id}', ${project.active})">${project.active ? 'Deactivate' : 'Activate'}</button>
<button class="btn btn-sm btn-danger" onclick="deleteProject('${project.id}', '${project.project_name.replace(/'/g, "\\'")}')">Delete</button>
```

**Why btn-secondary:** Differentiates toggle action from primary (Edit) and destructive (Delete) actions. Matches existing button styling patterns in components.css.

**Why ternary for button text:** Provides clear user intent - when project is active, show "Deactivate" to indicate what clicking will do.
  </action>
  <verify>
1. `npm test` or manual inspection: Line 379-381 in app/views/projects.js contains three buttons (Edit, Toggle, Delete)
2. Toggle button includes onclick handler calling toggleProjectActive
3. Toggle button text uses ternary: `${project.active ? 'Deactivate' : 'Activate'}`
4. Button passes project.id and project.active to function
  </verify>
  <done>
- Actions column in projects table has three buttons: Edit, Toggle (Deactivate/Activate), Delete
- Toggle button calls window.toggleProjectActive(projectId, currentStatus)
- Button text accurately reflects action (Deactivate for active projects, Activate for inactive)
- Gap closure verified: PROJ-06 requirement satisfied
  </done>
</task>

</tasks>

<verification>
**Manual test:**
1. Navigate to http://localhost:8000/#/projects
2. Locate any project in the table
3. Verify Actions column shows three buttons: Edit, Deactivate/Activate, Delete
4. Click Deactivate button on active project
5. Confirm dialog appears with "Deactivate this project?"
6. Confirm action
7. Verify project status badge changes from "Active" (green) to "Inactive" (red)
8. Verify button text changes from "Deactivate" to "Activate"
9. Click Activate button
10. Confirm project status badge changes back to "Active" (green)

**Automated verification:**
```bash
grep -n "onclick.*toggleProjectActive" app/views/projects.js
# Should return line ~380 with the toggle button
```

**PROJ-06 requirement satisfied when:**
- User can click button to toggle active status
- Confirmation dialog appears before change
- Status badge updates in real-time (via onSnapshot listener)
- Button text updates to match current state
</verification>

<success_criteria>
**Measurable completion:**
- [ ] app/views/projects.js modified at lines 379-381
- [ ] Toggle button added between Edit and Delete buttons
- [ ] Button includes onclick handler: `toggleProjectActive('${project.id}', ${project.active})`
- [ ] Button text uses ternary: `${project.active ? 'Deactivate' : 'Activate'}`
- [ ] Button uses btn-secondary class
- [ ] Manual test confirms toggle functionality works end-to-end
- [ ] Gap PROJ-06 closed in verification report

**Observable truth achieved:**
User can toggle project active/inactive status by clicking button in Actions column, with confirmation dialog and real-time UI updates.
</success_criteria>

<output>
After completion, create `.planning/phases/02-projects-core/02-03-SUMMARY.md` following the standard summary template.

Include in summary:
- Gap closed: PROJ-06 (toggle project active/inactive status)
- Function wired: toggleProjectActive (existing) now callable from UI
- UI pattern: Three-button Actions column (Edit, Toggle, Delete)
</output>
