---
phase: 07-project-assignment-system
plan: 05
type: execute
wave: 3
depends_on: [07-02, 07-03, 07-04]
files_modified: []
autonomous: false
user_setup: []

must_haves:
  truths:
    - "Super Admin can assign projects to an Operations User and see the changes take effect"
    - "Operations User project list reflects only assigned projects"
    - "Operations User MRF form dropdown reflects only assigned projects"
    - "Operations User MRF list in procurement reflects only assigned projects"
    - "All Projects toggle works: checked means unfiltered, unchecked means filtered"
    - "Assignment changes propagate in real time without logout"
    - "Access denied appears on project detail when project is removed from assignments"
    - "home.js dashboard stats are unaffected"
  artifacts:
    - path: "app/views/project-assignments.js"
      provides: "Verified working admin panel"
      contains: "handleAllProjectsChange"
    - path: "app/views/projects.js"
      provides: "Verified filtered project list"
      contains: "getAssignedProjectCodes"
    - path: "app/views/mrf-form.js"
      provides: "Verified filtered project dropdown"
      contains: "populateProjectDropdown"
    - path: "app/views/procurement.js"
      provides: "Verified filtered MRF list"
      contains: "reFilterAndRenderMRFs"
  key_links:
    - from: "app/views/project-assignments.js (updateDoc)"
      to: "app/auth.js (onSnapshot -> assignmentsChanged)"
      via: "Firestore real-time propagation to target user's browser"
      pattern: "assignmentsChanged"
    - from: "assignmentsChanged event"
      to: "projects.js, project-detail.js, mrf-form.js, procurement.js"
      via: "each view's addEventListener handler"
      pattern: "addEventListener.*assignmentsChanged"
---

<objective>
End-to-end human verification of the complete project assignment system.

Purpose: All four plans (07-01 through 07-04) are now complete. This checkpoint confirms that the full chain works: admin assigns projects, the target user's views update in real time, edge cases are handled correctly, and nothing outside scope was broken. The human tester should open two browser sessions (or tabs with different user accounts) to verify real-time propagation.

Output: Human sign-off that Phase 7 is working correctly, or a list of issues to address.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-project-assignment-system/07-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete project assignment system:
- 07-01: getAssignedProjectCodes utility + assignmentsChanged event in auth.js
- 07-02: Project Assignments admin panel (project-assignments.js) + route + nav link
- 07-03: Project list filter (projects.js) + access denied on detail (project-detail.js)
- 07-04: MRF form dropdown filter (mrf-form.js) + MRF list filter (procurement.js)
  </what-built>
  <how-to-verify>
Start the local server: `python -m http.server 8000`

You will need two accounts: one Super Admin (or Operations Admin) and one Operations User. If you only have one browser, you can use two different browser profiles or two private/incognito windows.

**Test Block 1: Admin panel basics**
1. Log in as Super Admin. Navigate to #/project-assignments (or click "Assignments" in the nav bar next to Settings).
2. Confirm the page loads and shows a list of all Operations Users.
3. Confirm each user shows their current assignment state (badge: All Projects / N project(s) / No projects).
4. If there are no Operations Users listed, the test cannot proceed -- check Firestore for users with role: operations_user.

**Test Block 2: Assign specific projects**
5. Pick an Operations User. Uncheck "All Projects" if it is checked.
6. Check exactly two project checkboxes for that user.
7. Confirm no error toast appears (save is silent).
8. Open Firestore console (or browser DevTools Network tab) and confirm the target user document now has assigned_project_codes: [code1, code2] and all_projects: false.

**Test Block 3: Operations User sees filtered views**
9. In the second session, log in as the Operations User from step 6.
10. Navigate to #/projects. Confirm the project list shows ONLY the two assigned projects (plus any legacy projects without project_code if they exist).
11. Navigate to #/mrf-form. Confirm the project dropdown contains only the two assigned projects.
12. Navigate to #/procurement (mrfs tab). Confirm the MRF list shows only MRFs belonging to the two assigned projects. If no MRFs exist for those projects, the list should be empty (not an error).

**Test Block 4: All Projects toggle**
13. Back in the admin session, check "All Projects" for the same Operations User.
14. In the Operations User session (no reload needed), confirm:
    - Project list now shows ALL projects
    - MRF form dropdown now shows ALL active projects
    - MRF list in procurement now shows ALL MRFs
15. This confirms real-time propagation via assignmentsChanged.

**Test Block 5: Zero assignments**
16. In the admin session, uncheck "All Projects" for the Operations User, and uncheck ALL individual project checkboxes. The user now has zero assignments.
17. In the Operations User session:
    - Project list shows no projects (or only legacy projects without project_code)
    - MRF form dropdown shows the hint: "No projects assigned -- contact your admin"
    - MRF list in procurement is empty

**Test Block 6: Access denied on project detail**
18. In the admin session, assign ONE project to the Operations User.
19. In the Operations User session, navigate to that project's detail page (#/projects/detail/PROJECT_CODE).
20. Confirm the project detail loads normally.
21. In the admin session, uncheck that project (or uncheck all projects).
22. In the Operations User session (still on the detail page, no reload), confirm an "Access Denied" message appears in place with a "Back to Projects" link. Do NOT expect a silent redirect.

**Test Block 7: Non-operations roles are unaffected**
23. Log in as Finance or Procurement role user.
24. Navigate to #/projects. Confirm ALL projects are shown (no filtering).
25. Navigate to #/ (Home/Dashboard). Confirm dashboard stats are unchanged and unfiltered.

**Test Block 8: Smoke test existing functionality**
26. As Super Admin, confirm Settings (#/role-config) still loads and works.
27. As Super Admin, confirm Clients (#/clients) still loads.
28. Confirm no JavaScript errors in browser DevTools console throughout all the above steps.
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass. Otherwise describe which test block failed and what the actual behavior was.</resume-signal>
</task>

</tasks>

<verification>
All 8 test blocks must pass:
1. Admin panel loads and shows Operations Users
2. Specific project assignment writes correctly to Firestore
3. Operations User views filter correctly for assigned projects
4. All Projects toggle removes filtering immediately
5. Zero assignments produces empty views and hint message
6. Access denied renders on project detail when project is removed
7. Non-operations roles see all data unfiltered
8. No regressions in existing functionality, no console errors
</verification>

<success_criteria>
- Full end-to-end assignment flow works: admin assigns -> user sees filtered views
- Real-time propagation confirmed (no logout/reload needed)
- All edge cases verified: zero assignments, all projects, legacy data, access denied
- No regressions in unrelated views or roles
- Dashboard (home.js) stats remain unfiltered
- Human approves with "approved"
</success_criteria>

<output>
After completion, create `.planning/phases/07-project-assignment-system/07-05-SUMMARY.md`
</output>
