---
phase: 08-security-rules-enforcement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - firebase.json
  - firestore.indexes.json
  - test/package.json
autonomous: true

must_haves:
  truths:
    - "Firebase CLI can read project configuration from firebase.json"
    - "Firestore emulator can start with configured port (8080)"
    - "Test dependencies are isolated in /test subfolder"
  artifacts:
    - path: "firebase.json"
      provides: "Firebase CLI project configuration"
      contains: "firestore"
    - path: "firestore.indexes.json"
      provides: "Placeholder indexes file"
      contains: "indexes"
    - path: "test/package.json"
      provides: "Test dependencies (mocha, @firebase/rules-unit-testing)"
      contains: "@firebase/rules-unit-testing"
  key_links:
    - from: "firebase.json"
      to: "firestore.rules"
      via: "rules path reference"
      pattern: '"rules":\\s*"firestore.rules"'
---

<objective>
Set up Firebase CLI infrastructure and test dependencies for Security Rules development

Purpose: Enable rules deployment and emulator-based testing. This is the foundation for all other Phase 8 work.
Output: firebase.json (CLI config), firestore.indexes.json (placeholder), test/package.json (test deps)
</objective>

<execution_context>
@C:\Users\Admin\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Admin\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-security-rules-enforcement/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Firebase CLI configuration files</name>
  <files>firebase.json, firestore.indexes.json</files>
  <action>
Create firebase.json at repo root with:
- firestore.rules path set to "firestore.rules"
- firestore.indexes path set to "firestore.indexes.json"
- Emulator config: Firestore on port 8080, UI on port 4000

Create firestore.indexes.json at repo root as a placeholder:
```json
{
  "indexes": [],
  "fieldOverrides": []
}
```

Do NOT run `firebase init` - create files manually to avoid interactive prompts and unnecessary files.

The firebase.json structure (from RESEARCH.md):
```json
{
  "firestore": {
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  },
  "emulators": {
    "firestore": {
      "port": 8080
    },
    "ui": {
      "enabled": true,
      "port": 4000
    }
  }
}
```
  </action>
  <verify>
Files exist at repo root:
- `ls firebase.json` shows file
- `ls firestore.indexes.json` shows file
- JSON is valid: `node -e "require('./firebase.json')"`
  </verify>
  <done>
- firebase.json exists with firestore rules path and emulator config
- firestore.indexes.json exists as valid JSON placeholder
  </done>
</task>

<task type="auto">
  <name>Task 2: Create test subfolder with package.json and dependencies</name>
  <files>test/package.json</files>
  <action>
Create test/ directory at repo root.

Create test/package.json with:
```json
{
  "name": "clmc-procurement-rules-tests",
  "version": "1.0.0",
  "description": "Firestore Security Rules tests for CLMC Procurement",
  "type": "module",
  "scripts": {
    "test": "mocha firestore.test.js --exit"
  },
  "devDependencies": {
    "@firebase/rules-unit-testing": "^3.0.0",
    "firebase": "^10.7.1",
    "mocha": "^10.2.0"
  }
}
```

Key decisions:
- `"type": "module"` enables ES module imports (matches the test file structure in RESEARCH.md)
- Firebase version 10.7.1 matches the SPA's CDN version (AUTH-01 decision)
- @firebase/rules-unit-testing v3 is the current stable version
- Test script runs from test/ directory

Do NOT run npm install yet - that happens in Plan 03 when tests are written.
  </action>
  <verify>
- `ls test/package.json` shows file exists
- JSON is valid: `node -e "require('./test/package.json')"`
- Contains @firebase/rules-unit-testing in devDependencies
  </verify>
  <done>
- test/ directory exists
- test/package.json exists with correct dependencies
- Package is configured for ES modules
  </done>
</task>

</tasks>

<verification>
All files created and valid JSON:
```bash
# From repo root
ls firebase.json firestore.indexes.json test/package.json
node -e "console.log('firebase.json:', !!require('./firebase.json'))"
node -e "console.log('indexes:', !!require('./firestore.indexes.json'))"
node -e "console.log('test pkg:', !!require('./test/package.json'))"
```
</verification>

<success_criteria>
- [ ] firebase.json exists at repo root with firestore and emulator config
- [ ] firestore.indexes.json exists at repo root as valid JSON
- [ ] test/package.json exists with @firebase/rules-unit-testing, firebase, mocha
- [ ] All JSON files parse without error
</success_criteria>

<output>
After completion, create `.planning/phases/08-security-rules-enforcement/08-01-SUMMARY.md`
</output>
