---
phase: 04-mrf-project-integration
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [app/views/procurement.js]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Project dropdown sorted by most recent first in ALL views"
    - "Procurement view dropdown matches mrf-form.js sorting behavior"
  artifacts:
    - path: "app/views/procurement.js"
      provides: "Project dropdown with created_at desc sort"
      contains: "bTime - aTime"
  key_links:
    - from: "app/views/procurement.js loadProjects()"
      to: "projectsData sort"
      via: "created_at timestamp comparison"
      pattern: "created_at.*getTime.*bTime - aTime"
---

<objective>
Fix project dropdown sorting inconsistency in procurement.js

Purpose: Ensure MRF-04 requirement "Project dropdown sorted by most recent first" is satisfied across ALL views, not just mrf-form.js
Output: Consistent user experience where project dropdowns show most recent projects first in both MRF creation AND MRF editing
</objective>

<execution_context>
@C:\Users\Admin\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Admin\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-mrf-project-integration/04-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix loadProjects() sorting in procurement.js</name>
  <files>app/views/procurement.js</files>
  <action>
Locate the loadProjects() function around line 416-432.

Find line 423:
```javascript
projectsData.sort((a, b) => a.project_name.localeCompare(b.project_name));
```

Replace with created_at descending sort (matching mrf-form.js lines 250-254):
```javascript
projectsData.sort((a, b) => {
    const aTime = a.created_at ? new Date(a.created_at).getTime() : 0;
    const bTime = b.created_at ? new Date(b.created_at).getTime() : 0;
    return bTime - aTime; // Most recent first
});
```

Update the comment above the sort from "Sort alphabetically" to "Sort by created_at descending (most recent first)".

This ensures consistency with mrf-form.js so users see the same project order in both:
- MRF submission form (mrf-form.js)
- MRF editing in procurement view (procurement.js)
  </action>
  <verify>
1. Search procurement.js for "bTime - aTime" pattern - should find the new sort
2. Search procurement.js for "localeCompare" near line 423 - should NOT find (replaced)
3. Manual test: Open browser, go to #/procurement/mrfs, click New MRF button, verify project dropdown shows most recent projects first
  </verify>
  <done>
- procurement.js loadProjects() sorts by created_at desc, not alphabetically
- Project dropdown order matches between mrf-form.js and procurement.js
- MRF-04 requirement fully satisfied across all views
  </done>
</task>

</tasks>

<verification>
1. Code verification: `grep -n "bTime - aTime" app/views/procurement.js` returns match around line 423
2. Code verification: `grep -n "localeCompare" app/views/procurement.js` does NOT match near loadProjects()
3. Functional: Project dropdown in procurement view shows recently created projects at top
</verification>

<success_criteria>
- loadProjects() in procurement.js uses created_at desc sort
- Project dropdown order consistent between mrf-form.js and procurement.js
- MRF-04 requirement "Project dropdown sorted by most recent first" verified in ALL views
</success_criteria>

<output>
After completion, create `.planning/phases/04-mrf-project-integration/04-03-SUMMARY.md`
</output>
