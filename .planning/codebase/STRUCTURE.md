# Codebase Structure

**Analysis Date:** 2026-01-23

## Directory Layout

```
pr-po/
├── app/                    # Application modules (ES6)
│   ├── views/             # View modules for each page
│   ├── components.js      # Reusable UI components
│   ├── firebase.js        # Firebase configuration
│   ├── router.js          # Hash-based routing
│   └── utils.js           # Shared utilities
├── styles/                # CSS stylesheets
│   ├── components.css     # Component styles
│   ├── hero.css          # Landing page styles
│   ├── main.css          # Base styles and variables
│   └── views.css         # View-specific layouts
├── archive/               # Original monolithic HTML files (reference only)
│   ├── finance.html       # Original finance dashboard (archived)
│   ├── index.html         # Original procurement dashboard (archived)
│   └── mrf-submission-form.html  # Original form (archived)
├── .planning/             # GSD planning documents
│   └── codebase/         # Codebase analysis documents
├── index.html             # Single page entry point
├── netlify.toml           # Netlify deployment config
├── _headers               # Netlify/Cloudflare HTTP headers
├── .htaccess              # Apache HTTP headers config
├── nginx-headers.conf     # Nginx HTTP headers config
├── CLAUDE.md              # Project instructions for Claude
├── MIGRATION-STATUS.md    # SPA migration tracking
└── HEADERS-README.md      # HTTP security headers documentation
```

## Directory Purposes

**app/**
- Purpose: Core application code organized as ES6 modules
- Contains: Router, Firebase service, utilities, components, and view modules
- Key files:
  - `router.js` - Hash-based SPA router with lazy loading (245 lines)
  - `firebase.js` - Centralized Firebase configuration (84 lines)
  - `utils.js` - Shared utility functions (381 lines)
  - `components.js` - Reusable UI component generators (350+ lines)

**app/views/**
- Purpose: View modules for each application screen
- Contains: View-specific logic with render/init/destroy lifecycle
- Key files:
  - `home.js` - Landing page with live stats (164 lines)
  - `mrf-form.js` - MRF submission form (536 lines)
  - `procurement.js` - Procurement dashboard with 4 tabs (4,459 lines)
  - `finance.js` - Finance dashboard with 3 tabs (1,068 lines)
  - `procurement-base.js` - Experimental base class (331 lines, not in use)

**styles/**
- Purpose: CSS stylesheets organized by concern
- Contains: Base styles, component styles, view layouts, landing page styles
- Key files:
  - `main.css` - CSS variables, reset, base styles (293 lines)
  - `components.css` - Buttons, cards, tables, modals, badges, pagination (1,069 lines)
  - `views.css` - View-specific layouts and grids (796 lines)
  - `hero.css` - Landing page hero section styles (269 lines)

**archive/**
- Purpose: Preserved original monolithic HTML files for reference
- Contains: Original pre-migration HTML files (DO NOT EDIT)
- Key files:
  - `index.html` - Original procurement dashboard (5,785 lines)
  - `finance.html` - Original finance dashboard (4,965 lines)
  - `mrf-submission-form.html` - Original form (799 lines)
- Status: Migration complete, files kept for historical reference only

**.planning/**
- Purpose: GSD (Get Stuff Done) planning documents directory
- Contains: Codebase analysis documents generated by /gsd:map-codebase
- Key files:
  - `codebase/ARCHITECTURE.md` - Architecture patterns and data flow
  - `codebase/STRUCTURE.md` - Directory layout and file organization
  - Additional docs based on GSD analysis (STACK.md, CONVENTIONS.md, etc.)

## Key File Locations

**Entry Points:**
- `index.html`: Single page application entry point, loads all modules
- `app/router.js`: Router initialization, navigation entry point
- `app/firebase.js`: Firebase initialization (auto-executes on import)

**Configuration:**
- `netlify.toml`: Netlify deployment and HTTP headers configuration
- `_headers`: Alternative headers config for Netlify/Cloudflare
- `.htaccess`: Apache server HTTP headers configuration
- `nginx-headers.conf`: Nginx server HTTP headers configuration
- No package.json - zero dependencies, Firebase loaded from CDN

**Core Logic:**
- `app/views/procurement.js`: MRF management, supplier CRUD, PR generation, PO tracking (4,459 lines)
- `app/views/finance.js`: PR/TR approval, PO generation, finance dashboard (1,068 lines)
- `app/views/mrf-form.js`: Public MRF submission form with validation (536 lines)
- `app/views/home.js`: Landing page with navigation cards and real-time stats (164 lines)

**Utilities:**
- `app/utils.js`: 381 lines of shared functions
  - Formatting: formatCurrency, formatDate, formatTimestamp, parseItems
  - UI: showLoading, showToast, showAlert
  - Data: generateSequentialId, getActiveProjects, getAllSuppliers, calculateTotal
  - Validation: validateEmail, validatePhone, validateRequired
  - Status: getStatusClass, getUrgencyClass
  - Storage: saveToStorage, getFromStorage, removeFromStorage

**Components:**
- `app/components.js`: Reusable UI generators
  - createStatusBadge, createUrgencyBadge
  - createCard, createModal
  - openModal, closeModal
  - Pagination helpers

**Documentation:**
- `CLAUDE.md`: Comprehensive project instructions for Claude Code (42,556 bytes)
- `MIGRATION-STATUS.md`: SPA migration tracking and status (10,202 bytes)
- `HEADERS-README.md`: HTTP security headers documentation (3,368 bytes)

## Naming Conventions

**Files:**
- **Views**: Lowercase with hyphens: `mrf-form.js`, `procurement.js`
- **Core modules**: Lowercase single word: `router.js`, `firebase.js`, `utils.js`
- **CSS**: Lowercase single word: `main.css`, `components.css`, `views.css`
- **HTML**: Lowercase with hyphens (archive only): `mrf-submission-form.html`
- **Documentation**: UPPERCASE for important docs: `CLAUDE.md`, `MIGRATION-STATUS.md`

**Directories:**
- Lowercase single word: `app`, `views`, `styles`, `archive`
- Hidden directories: `.planning`, `.claude`, `.git`

**Functions:**
- **Exported functions**: camelCase: `render()`, `init()`, `destroy()`
- **View functions**: camelCase: `loadMRFs()`, `generatePR()`, `approvePR()`
- **Window functions**: Same name as module function, attached to window
- **Utility functions**: camelCase with verb prefix: `formatCurrency()`, `showToast()`, `validateEmail()`

**Variables:**
- **State variables**: camelCase: `currentMRF`, `suppliersData`, `poCurrentPage`
- **Constants**: camelCase with descriptive name: `itemsPerPage`, `listeners`
- **Firebase collections**: Lowercase plural: `mrfs`, `prs`, `pos`, `suppliers`, `projects`
- **Document IDs**: Uppercase with hyphens: `MRF-2026-001`, `PR-2026-005`

**CSS Classes:**
- **BEM-like**: Component-element pattern
  - Components: `.card`, `.btn`, `.modal`, `.nav-card`
  - Modifiers: `.btn-primary`, `.btn-secondary`, `.status-badge`
  - Elements: `.card-header`, `.card-body`, `.modal-content`
- **Utility classes**: Lowercase with hyphens: `.loading-spinner`, `.empty-state`
- **State classes**: `.active`, `.show`, `.disabled`

**Route Paths:**
- Hash-based with slash separator: `#/`, `#/mrf-form`, `#/procurement`
- Sub-routes (tabs): `#/procurement/mrfs`, `#/finance/approvals`
- Pattern: `#/view-name/tab-name`

## Where to Add New Code

**New Feature (e.g., new workflow step):**
- Primary code: Add function to relevant view file in `app/views/`
  - Example: Add to `app/views/procurement.js` for procurement features
  - Export function if needed by other modules
  - Attach to window if used in onclick handlers
- Tests: No test infrastructure (manual testing only)
- Styles: Add to `styles/views.css` for view-specific styles
- Components: Add reusable UI to `app/components.js` if needed across views

**New View/Page:**
- Implementation: Create new file in `app/views/`
  - Must export: `render(activeTab)`, `init(activeTab)`, `destroy()`
  - Follow lifecycle pattern: render HTML, set up listeners, clean up
  - Store listeners in array for cleanup in destroy()
- Router: Add route definition to `app/router.js` routes object
  - Specify: name, load function (dynamic import), title, defaultTab
- Navigation: Add link to `index.html` top navigation bar
  - Format: `<a href="#/view-name" class="nav-link">View Name</a>`
- Styles: Add view-specific styles to `styles/views.css`

**New Component/Module:**
- Reusable UI: Add to `app/components.js`
  - Export factory function that returns HTML string
  - Example: `export function createNewComponent(options) { return '...' }`
- Utility function: Add to `app/utils.js`
  - Export function from module
  - Add to window.utils object for onclick access
  - Group with related functions (formatting, validation, etc.)
- Firebase operation: Use exports from `app/firebase.js`
  - Import needed functions: `import { collection, addDoc } from '../firebase.js'`
  - No need to modify firebase.js unless adding new Firebase service

**Utilities:**
- Shared helpers: Add to `app/utils.js`
  - Categories: Formatting, UI, Data, Validation, Status, Storage
  - Export from module: `export function newUtility() { ... }`
  - Add to window.utils object: `window.utils = { ..., newUtility }`
  - Document with JSDoc comment

**New Firebase Collection:**
- No schema file needed (Firestore is schemaless)
- Document in `CLAUDE.md` under "Firebase Firestore Schema"
- Include: Collection name, document fields, field types, relationships
- Follow ID pattern: `{PREFIX}-{YEAR}-{###}` (e.g., MRF-2026-001)

**Styles:**
- Component styles: Add to `styles/components.css`
  - Group by component type: buttons, cards, tables, modals, etc.
  - Use CSS variables from main.css for colors
  - Include hover, active, disabled states
- View-specific styles: Add to `styles/views.css`
  - Group by view name with comments
  - Use grid/flexbox for layouts
  - Include responsive breakpoints
- Base styles: Modify `styles/main.css` only for global changes
  - CSS variables, reset, typography, utilities

## Special Directories

**archive/**
- Purpose: Historical reference of pre-migration HTML files
- Generated: No (manually created during migration)
- Committed: Yes
- Important: DO NOT EDIT - these files are no longer used in production
- Status: Migration complete (100%), SPA architecture fully operational

**.git/**
- Purpose: Git version control metadata
- Generated: Yes (by git)
- Committed: No (ignored by git)
- Branch pattern: `claude/feature-description-xxxxx`

**.planning/**
- Purpose: GSD planning and codebase analysis documents
- Generated: Yes (by /gsd:map-codebase and other GSD commands)
- Committed: Yes (tracked for team reference)
- Contains: ARCHITECTURE.md, STRUCTURE.md, and other analysis documents

**.claude/**
- Purpose: Claude Code settings and local configuration
- Generated: Yes (by Claude Code)
- Committed: No (local settings only)
- Contains: settings.local.json with user preferences

**node_modules/**
- Purpose: N/A (no Node.js dependencies in this project)
- Status: Does not exist
- Note: This is a zero-build project - no npm, no package.json
- Dependencies: Only Firebase SDK loaded from CDN

## File Organization Patterns

**View Modules:**
- Lifecycle exports at top: render(), init(), destroy()
- State variables after imports
- Helper functions in logical groups
- Window function attachment in dedicated function
- Cleanup in destroy() function

**Imports Pattern:**
- Firebase imports from '../firebase.js'
- Utility imports from '../utils.js'
- Component imports from '../components.js'
- No relative path traversal beyond one level

**State Management:**
- Module-scoped variables for view state
- Listeners array for Firebase subscriptions
- Current item tracking: currentMRF, currentPRForApproval, etc.
- Pagination state: currentPage, itemsPerPage

**HTML Structure:**
- Tab navigation at top (for multi-tab views)
- Container with max-width for content
- Section per tab with active class toggle
- Card components for logical grouping
- Tables with consistent thead/tbody structure

**CSS Organization:**
- CSS variables at top of main.css
- Component styles grouped by type
- States (hover, active, disabled) after base styles
- Media queries at end of each component
- Comments to separate major sections

**Function Ordering (in views):**
1. Imports
2. State variables
3. Window function attachment
4. Render function (export)
5. Init function (export)
6. Destroy function (export)
7. Data loading functions
8. UI update functions
9. Action handler functions
10. Helper functions
11. Console log statements

---

*Structure analysis: 2026-01-23*
