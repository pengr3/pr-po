# Requirements Archive: v2.1 System Refinement

**Archived:** 2026-02-06
**Status:** ✅ SHIPPED

This is the archived requirements specification for v2.1.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: CLMC Procurement System v2.1

**Defined:** 2026-02-05
**Core Value:** Projects tab must work - it's the foundation where project name and code originate, and everything in the procurement system connects to it.

## v1 Requirements

Requirements for v2.1 System Refinement milestone. All items are critical as they block or break core workflows.

### Security & Permissions

- [x] **SEC-01**: Super Admin can access Clients tab without permission denied errors
- [x] **SEC-02**: Super Admin can access Projects tab without permission denied errors
- [x] **SEC-03**: Super Admin user documents have proper permission structure OR Security Rules bypass permission checks for admin role
- [x] **SEC-04**: Operations Admin role can receive project assignments (assignable by Super Admin or Operations Admin)

### Finance Workflow

- [x] **FIN-01**: Transport Request Review button works (no `window.viewTRDetails is not a function` error)
- [x] **FIN-02**: Material Purchase Request Review button works (no similar window function error)
- [x] **FIN-03**: Finance tab displays Project List with financial overview table and expense breakdown modal

### Procurement Features

- [x] **PROC-01**: Clicking supplier name opens modal showing all purchases from that supplier
- [x] **PROC-02**: Timeline button in PR-PO Records shows full audit trail (MRF → PRs → POs → Delivered)
- [x] **PROC-03**: Viewing PO requires Payment Terms, Condition, and Delivery Date to be filled (workflow gate)

## v2 Requirements

Deferred to future releases.

### Finance Enhancements

- **FIN-04**: Project List shows budget vs actual tracking with trend analysis
- **FIN-05**: Financial dashboard exports to PDF for compliance reporting

### Procurement Enhancements

- **PROC-04**: Timeline shows parallel approval visualization for mixed-supplier PRs
- **PROC-05**: Timeline events are filterable by type (MRF/PR/PO/Status)
- **PROC-06**: Supplier purchase history includes performance metrics (cycle time, on-time delivery)

## Out of Scope

| Feature | Reason |
|---------|--------|
| Cloud Audit Logs for timeline | Cost overruns ($50-200/month vs $1/month for app-level logging) - use Firestore collection instead |
| Real-time chat/notifications | Not core to fixing existing workflows, deferred to future milestones |
| Mobile responsive fixes | Desktop-first constraint, mobile deferred to future |
| OAuth/SSO integration | Email/password sufficient, added complexity not warranted for bug fixes |

## Traceability

Which phases cover which requirements. Updated during roadmap creation.

| Requirement | Phase | Status |
|-------------|-------|--------|
| SEC-01 | Phase 11 | Complete |
| SEC-02 | Phase 11 | Complete |
| SEC-03 | Phase 11 | Complete |
| SEC-04 | Phase 11 | Complete |
| FIN-01 | Phase 12 | Complete |
| FIN-02 | Phase 12 | Complete |
| FIN-03 | Phase 13 | Complete |
| PROC-01 | Phase 13 | Complete |
| PROC-02 | Phase 13 | Complete |
| PROC-03 | Phase 14 | Complete |

**Coverage:**
- v1 requirements: 10 total
- Mapped to phases: 10/10 ✓
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 10 of 10 v1 requirements (100% completion)

**Adjusted:** None - all requirements shipped as originally defined

**Dropped:** None - all requirements essential for core workflow functionality

**Notable Outcomes:**

- **SEC-01-SEC-04**: Security Rules additions eliminated permission errors and enabled Operations Admin assignments. 11 test cases added validating access patterns.
- **FIN-01-FIN-02**: Window function lifecycle fixes restored Finance review workflow. ESC key modal dismissal added for accessibility.
- **FIN-03**: Project List tab implemented with server-side aggregated expense totals using getAggregateFromServer for cost efficiency.
- **PROC-01**: Supplier purchase history modal with aggregation queries showing total purchases and detailed PO history.
- **PROC-02**: Procurement timeline modal displays complete MRF → PR → TR → PO audit trail using reusable createTimeline component.
- **PROC-03**: Quality gate validation enforces PO data completeness before viewing, with form modal pattern for field collection.

**Phase Execution:**

- Phase 11: 2 plans in <1 day (Security Rules and test suite additions)
- Phase 12: 2 plans in <1 day (Window function lifecycle and ESC key handling)
- Phase 13: 5 plans in 2 days (Financial dashboards, supplier history, timeline, indexes)
- Phase 14: 1 plan in 3 minutes (PO quality gate validation)

**Technical Improvements:**

- Server-side aggregation pattern using getAggregateFromServer (1 read per 1000 entries vs 1 per document)
- AbortController pattern for event listener lifecycle management
- attachWindowFunctions() pattern preventing window function lifecycle bugs
- Timeline component reuse for consistent audit trail presentation
- Quality gate pattern for workflow data completeness enforcement

---
*Requirements defined: 2026-02-05*
*Last updated: 2026-02-06 - all v1 requirements complete*
*Archived: 2026-02-06 as part of v2.1 milestone completion*
